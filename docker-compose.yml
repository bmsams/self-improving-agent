version: "3.8"

services:
  agent:
    build: .
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - AGENT_PROVIDER=${AGENT_PROVIDER:-anthropic}
      - AGENT_LOG_LEVEL=${AGENT_LOG_LEVEL:-INFO}
    volumes:
      - ./reports:/app/reports
      - ./config:/app/config
    command: ["run", "--auto-merge"]

  test:
    build: .
    entrypoint: ["python", "-m", "pytest"]
    command: ["tests/", "-v", "--tb=short"]

  bench:
    build: .
    command: ["bench"]
    volumes:
      - ./reports:/app/reports
